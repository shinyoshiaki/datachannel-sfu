{"version":3,"sources":["hooks/useInput.tsx","components/send.tsx","App.tsx","hooks/useApi.tsx","index.tsx"],"names":["useInput","init","_useState","useState","_useState2","Object","slicedToArray","value","setvalue","e","target","Send","_ref","peer","_useInput","_useInput2","msg","setmsg","clear","react_default","a","createElement","placeholder","onChange","onClick","isConnected","send","url","App","state","useRef","WebRTC","trickle","log","setlog","room","setroom","_useApi","promise","onSuccess","loading","setLoading","_useState3","_useState4","error","setError","_useState5","_useState6","result","setresult","fetch","asyncToGenerator","regenerator_default","mark","_callee","p","res","wrap","_context","prev","next","t0","sent","undefined","abrupt","stop","_x","apply","this","arguments","useApi","_res$data","sdp","uu","current","axios","post","data","setSdp","Promise","r","onSignal","subscribe","_ref2","type","ice","onConnect","once","console","onData","v","components_send","ReactDOM","render","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.b2be19cd.chunk.js","sourcesContent":["import { useState } from \"react\";\n\nexport default function useInput(\n  init?: string\n): [string, (e: any) => void, () => void] {\n  const [value, setvalue] = useState(init || \"\");\n  const input = (e: any) => {\n    setvalue(e.target.value);\n  };\n\n  const clear = () => {\n    setvalue(\"\");\n  };\n\n  return [value, input, clear];\n}\n","import React, { FC } from \"react\";\nimport useInput from \"../hooks/useInput\";\nimport WebRTC from \"webrtc4me\";\n\nconst Send: FC<{ peer: WebRTC }> = ({ peer }) => {\n  const [msg, setmsg, clear] = useInput();\n\n  const send = () => {\n    if (peer.isConnected) {\n      peer.send(msg);\n      clear();\n    }\n  };\n\n  return (\n    <div>\n      <input placeholder=\"send\" onChange={setmsg} value={msg} />\n      <button onClick={send}>send</button>\n    </div>\n  );\n};\n\nexport default Send;\n","import React, { useRef, useState } from \"react\";\nimport axios from \"axios\";\nimport WebRTC from \"webrtc4me\";\nimport { useApi } from \"./hooks/useApi\";\nimport useInput from \"./hooks/useInput\";\nimport Send from \"./components/send\";\n\nconst url =\n  process.env.NODE_ENV === \"production\"\n    ? \"http://34.73.92.59:8088\"\n    : \"http://localhost:8088\";\n\nconst App: React.FC = () => {\n  const state = useRef({ peer: new WebRTC({ trickle: true }) });\n  const [log, setlog] = useState(\"\");\n  const [room, setroom] = useInput(\"a\");\n\n  const { fetch, loading, error, result } = useApi(\n    async () => {\n      if (room) {\n        const { peer } = state.current;\n\n        if (peer.isConnected) return null;\n\n        const res = await axios.post<{ sdp: any; uu: string }>(url + \"/join\", {\n          room\n        });\n        const { sdp, uu } = res.data;\n        peer.setSdp(sdp);\n        await new Promise(r => {\n          peer.onSignal.subscribe(({ sdp, type, ice }) => {\n            sdp = sdp ? sdp : (ice as any);\n            axios.post(url + \"/answer\", { type, sdp, room, uu });\n          });\n          peer.onConnect.once(r);\n        });\n        return { uu };\n      }\n    },\n    () => {\n      console.log(\"connected\");\n      const { peer } = state.current;\n      peer.onData.subscribe(v => {\n        console.log({ v });\n        typeof v.data === \"string\" && setlog(v.data);\n      });\n    }\n  );\n\n  return (\n    <div>\n      <input placeholder=\"room\" onChange={setroom} value={room} />\n      <button onClick={fetch}>join</button>\n      {loading && <p>loading</p>}\n      {error && <p>error</p>}\n      {result && <p>{result.uu}</p>}\n      <Send peer={state.current.peer} />\n      <p>{log}</p>\n    </div>\n  );\n};\n\nexport default App;\n","import { useState } from \"react\";\n\ntype Head<T extends any[], D = never> = T extends [infer X, ...any[]] ? X : D;\n\nexport function useApi<T, A>(\n  promise: (obj: A) => Promise<T>,\n  onSuccess?: (res: NonNullable<T>) => void\n) {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(false);\n  const [result, setresult] = useState<T>();\n\n  const fetch = async (p: Head<Parameters<typeof promise>>) => {\n    setLoading(true);\n    const res = p ? await promise(p as any) : await promise(undefined as any);\n    if (!res) setError(true);\n\n    setLoading(false);\n    setresult(res);\n    onSuccess && res && onSuccess(res!);\n    return res;\n  };\n\n  return { loading, fetch, error, result };\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}